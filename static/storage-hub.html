<!DOCTYPE html>
<html>
<head>
  <title>Storage Hub</title>
</head>
<body>
  <script>
    const STORAGE_KEY = 'betslip-count';

    // 1. Listen for messages from parent windows to set data
    window.addEventListener('message', (event) => {
      // In a production environment, you should validate event.origin for security
      if (event.data && event.data.type === 'set') {
        localStorage.setItem(STORAGE_KEY, event.data.count);
      }
    });

    // 2. Listen for storage changes (from other hubs) and notify the parent window
    window.addEventListener('storage', (event) => {
      if (event.key === STORAGE_KEY) {
        window.parent.postMessage({
          type: 'update',
          count: event.newValue
        }, '*'); // Use a specific target origin in production
      }
    });

    // 3. On initial load, send the current value to the parent
    window.addEventListener('load', () => {
        const initialCount = localStorage.getItem(STORAGE_KEY) || '0';
        window.parent.postMessage({
            type: 'update',
            count: initialCount
        }, '*'); // Use a specific target origin in production
    });
  </script>
</body>
</html>
